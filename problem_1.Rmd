---
title: "Data Intro and EDA"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(GGally)
library(reshape2)
library(plotly)
```
# (a) Write a half-page summary of the paper, including at least the purpose of the study, the data, the collection method, its conclusions and potential impact.

  The purpose of this study was to build an accurate cloud detection algorithm that can process Multiangle Imaging SpectroRadiometer data without human intervention. The world has seen an increase in green and sustainable climate initiatives in the last 20 years, discussions which often begin with an analysis of cloud formation. Clouds in the polar regions have the most affect on global climate and it is difficult to discern between white snow and white clouds from satellite images. It is imperative to have reliable algorithms which can distinguish between the two, in order to have accurate global climate models. 
  The data in this study were collected from ten orbits over one path completed by NASA's Terra satellite, equipped with a Multiangle Imaging SpectroRadiometer in 2002. The paper analyzed 57 data units with 7,114,248 1.1-km resolution pixels with 36 radiation measurements for each pixel. The analysts focused on the 275-m red radiation measurements to build some of the features, so the entire data set is even larger. The sudy includes repeated visits over time to improve the expert labeling process, which also serve as the 'true' labels.
  This study portrays the power of statistical thinking, and its impact when tackling complex scientific problems. The aim of this research is to gain a better understanding of the flow of visible and infrared radiation in the atmosphere, subsequently studying its response on clouds and changes in the arctic climate. Accurate arctic cloud models will yield a more complete and sound global climate model. Eventually these studies will elude to how changing cloud properties affect initial changes in the arctic, as concentrations of carbon increase in the atmosphere. 
  

# (b) Summarize the data, i.e., % of pixels for the different classes. Plot well-labeled beautiful maps using x, y coordinates the expert labels with color of the region based on the expert labels. Do you observe some trend/pattern? Is an i.i.d. assump- tion for the samples justified for this dataset?
```{r}
#make data frames from the txt files
library(dplyr)
library(ggplot2)

images_columns <- c("y", "x","cloud_label","NDAI","SD","CORR","rad_DF","rad_CF",
                    "rad_BF","rad_AF","rad_AN" )
image1 <- read.delim("./image_data/image1.txt", sep="", col.names = images_columns)
image2 <- read.delim("./image_data/image2.txt", sep="", col.names = images_columns)
image3 <- read.delim("./image_data/image3.txt", sep="", col.names = images_columns)
```

```{r}
#calculate percentage of pixels in each class, summarize data
pixel_perc <- function(image){
  n <- nrow(image)
  cloud <- nrow(filter(image, cloud_label==1))
  nocloud <- nrow(filter(image, cloud_label==-1))
  nolabel <- nrow(filter(image, cloud_label==0))
  return(list("cloud"=round(cloud/n,2), "no cloud"=round(nocloud/n, 2), 
              "unlabelled"=round(nolabel/n,2)))
}

i1_proportions <- pixel_perc(image1)
i2_proportions <- pixel_perc(image2)
i3_proportions <- pixel_perc(image3)
pixels <- data.frame(Image1=unlist(pixel_perc(image1)), Image2=unlist(pixel_perc(image2)), Image3=unlist(pixel_perc(image3)))

pixels
```


```{r}
#images beautiful maps
colors <- c("#56B4E9", "#999999", "orange")
ggplot(image1,aes(x=x, y=y, fill=factor(cloud_label)))+
  geom_tile()+
  labs(fill= "Cloud?",
        title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()

ggplot(image2)+
  geom_tile(aes(x=x, y=y, fill=factor(cloud_label)))+
  labs(fill= "Cloud?",
       title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()

ggplot(image3)+
  geom_tile(aes(x=x, y=y, fill=factor(cloud_label)))+
  labs(fill= "Cloud?",
       title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()
```

Do we observe some trend/pattern? More Summary?
There are large amounts of unlabelled data, generally on the border between cloud and no-cloud areas. Clouds exist in regions much larger than one pixel, and thus are grouped spacially. 

Is an iid assumption for the samples justified?
An iid assumption for the samples is not justifed, becuase they are not independant. The value of one pixel is dependent on that of the pixels next to it, as demonstrated by the shape of the clouds and no-cloud regions above. 

# (c) Perform a visual and quantitative EDA of the dataset, e.g., summarizing (i) pair- wise relationship between the features themselves and (ii) the relationship between the expert labels with the individual features. Do you notice differences between the two classes (cloud, no cloud) based on the radiance or other features (CORR, NDAI, SD)?

```{r}
# quantitative pairwise relationship between features
cormat1 <- round(cor(image1),3)
cormat2 <- round(cor(image2),3)
cormat3 <- round(cor(image3),3)

#I could make these just lower half if that's better
melted_cormat1 <- melt(cormat1)
ggplot(data = melted_cormat1, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 1")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")

melted_cormat2 <- melt(cormat2)
ggplot(data = melted_cormat2, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 2")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")

melted_cormat3 <- melt(cormat3)
ggplot(data = melted_cormat3, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 3")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")
```
Why are some regions unlabelled? Is it okay that we're leaving the unlabelled stuff in until problem 2, for the EDA stuff? I think it's useful here how radiation correlates with what's unlabelled, even if we cant train the model with that data. 

```{r}
# relationship between NDAI and cloud labels
ggplot(image1, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image3")
```

```{r}
# relationship between CORR and cloud labels
ggplot(image1, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image3")
```

```{r}
# relationship between SD and cloud labels
ggplot(image1, aes(x=cloud_label, y=SD)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("SD and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=SD)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("SD and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=SD)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("SD and Cloud Label on image3")
```

```{r}
# relationship between rad_DF and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image3")
```

```{r}
# relationship between rad_CF and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_CF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_CF and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_CF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_CF and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_CF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_CF and Cloud Label on image3")
```

```{r}
# relationship between rad_BF and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_BF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_BF and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_BF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_BF and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_BF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_BF and Cloud Label on image3")
```

```{r}
# relationship between rad_AF and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_AF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AF and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_AF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AF and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_AF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AF and Cloud Label on image3")
```

```{r}
# relationship between rad_AN and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_AN)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AN and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_AN)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AN and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_AN)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_AN and Cloud Label on image3")
```


