---
title: "Data Intro and EDA"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(GGally)
library(reshape2)
library(plotly)
```
# (a) Write a half-page summary of the paper, including at least the purpose of the study, the data, the collection method, its conclusions and potential impact.

  The purpose of this study is to build an accurate cloud detection algorithm that can process Multiangle Imaging SpectroRadiometer data without human intervention. In the last 20 years, there has been a global increase in green and sustainable climate initiatives, discussions which often begin with an analysis of cloud formation. Clouds in the polar regions have the most effect on global climate, and it is difficult to discern between white snow and white clouds from satellite images. Thus, it is imperative to have reliable algorithms that accurately distinguish between snow and clouds in order to have accurate global climate models. 
  The data in this study were completed in 2002 by NASA's Terra satellite, which is equipped with a Multiangle Imaging SpectroRadiometer and collected from ten orbits over one path. The paper analyzed 57 data units with 7,114,248 1.1-km resolution pixels with 36 radiation measurements for each pixel. The analysts focused on the 275-m red radiation measurements to build some of the features, so the entire data set has even more features. The sudy includes repeated visits over time to improve the expert labeling process, which also serve as the 'true' labels.
  This study portrays the power of statistical thinking, and its impact when tackling complex scientific problems. The aim of this research is to gain a better understanding of the flow of visible and infrared radiation in the atmosphere, subsequently studying its response on clouds and changes in the arctic climate. Accurate arctic cloud models will yield a more complete and sound global climate model. Eventually these studies will elude to how changing cloud properties affect initial changes in the arctic, as concentrations of carbon increase in the atmosphere. 
  

# (b) Summarize the data, i.e., % of pixels for the different classes. Plot well-labeled beautiful maps using x, y coordinates the expert labels with color of the region based on the expert labels. Do you observe some trend/pattern? Is an i.i.d. assump- tion for the samples justified for this dataset?
```{r}
#make data frames from the txt files
library(dplyr)
library(ggplot2)

images_columns <- c("y", "x","cloud_label","NDAI","SD","CORR","rad_DF","rad_CF",
                    "rad_BF","rad_AF","rad_AN" )
image1 <- read.delim("./image_data/image1.txt", sep="", col.names = images_columns)
image2 <- read.delim("./image_data/image2.txt", sep="", col.names = images_columns)
image3 <- read.delim("./image_data/image3.txt", sep="", col.names = images_columns)
```

```{r}
#calculate percentage of pixels in each class, summarize data
pixel_perc <- function(image){
  n <- nrow(image)
  cloud <- nrow(filter(image, cloud_label==1))
  nocloud <- nrow(filter(image, cloud_label==-1))
  nolabel <- nrow(filter(image, cloud_label==0))
  return(list("cloud"=round(cloud/n,2), "no cloud"=round(nocloud/n, 2), 
              "unlabelled"=round(nolabel/n,2)))
}

i1_proportions <- pixel_perc(image1)
i2_proportions <- pixel_perc(image2)
i3_proportions <- pixel_perc(image3)
pixels <- data.frame(Image1=unlist(pixel_perc(image1)), Image2=unlist(pixel_perc(image2)), Image3=unlist(pixel_perc(image3)))

pixels
```


```{r}
#images beautiful maps
colors <- c("#56B4E9", "#999999", "orange")
ggplot(image1,aes(x=x, y=y, fill=factor(cloud_label)))+
  geom_tile()+
  labs(fill= "Cloud?",
        title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()

ggplot(image2)+
  geom_tile(aes(x=x, y=y, fill=factor(cloud_label)))+
  labs(fill= "Cloud?",
       title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()

ggplot(image3)+
  geom_tile(aes(x=x, y=y, fill=factor(cloud_label)))+
  labs(fill= "Cloud?",
       title="Expert Labels")+
  scale_fill_manual(values=colors,
                    labels=c("No Clouds", "Unlabelled", "Clouds")) +
  theme_classic()
```


  There are large amounts of unlabelled data, generally on the border between cloud and no-cloud areas. Clouds exist in regions much larger than one pixel, and thus are grouped spacially. 
  An iid assumption for the samples is not justifed, becuase they are not independant. The value of one pixel is dependent on that of the pixels next to it, as demonstrated by the shape of the clouds and no-cloud regions above. 

# (c) Perform a visual and quantitative EDA of the dataset, e.g., summarizing (i) pair- wise relationship between the features themselves and (ii) the relationship between the expert labels with the individual features. Do you notice differences between the two classes (cloud, no cloud) based on the radiance or other features (CORR, NDAI, SD)?

```{r}
# quantitative pairwise relationship between features
cormat1 <- round(cor(image1),3)
cormat2 <- round(cor(image2),3)
cormat3 <- round(cor(image3),3)

#I could make these just lower half if that's better
melted_cormat1 <- melt(cormat1)
ggplot(data = melted_cormat1, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 1")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")

melted_cormat2 <- melt(cormat2)
ggplot(data = melted_cormat2, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 2")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")

melted_cormat3 <- melt(cormat3)
ggplot(data = melted_cormat3, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile()+
  ggtitle("Variable Correlation: Image 3")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
   midpoint = 0, limit = c(-1,1), space = "Lab", 
   name="Correlation Value")
```

  These heat maps depict the pairwise relationship between features in the data set. We notice high correlation between the radiance angles, which makes sense intuitively since they represent similar values. This heatmap also illustrates the correlation between the features and cloud labels. NDAI and CORR look to have relatively high correlation with cloud label in comparison to the other features. 

```{r}
# relationship between NDAI and cloud labels
ggplot(image1, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=NDAI)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("NDAI and Cloud Label on image3")
```

```{r}
# relationship between CORR and cloud labels
ggplot(image1, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=CORR)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("CORR and Cloud Label on image3")
```

```{r}
# relationship between SD and cloud labels
ggplot(image1, aes(x=cloud_label, y=SD)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("SD and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=SD)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("SD and Cloud Label on image2")

```

```{r}
# relationship between rad_DF and cloud labels
ggplot(image1, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image1")

ggplot(image2, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image2")

ggplot(image3, aes(x=cloud_label, y=rad_DF)) + 
  geom_violin() + 
  theme_minimal() +
  ggtitle("rad_DF and Cloud Label on image3")
```
##Do you notice differences between the two classes (cloud, no cloud) based on the radiance or other features (CORR, NDAI, SD)?
  The radiance angles are highly correlated with eachother, so their relationship to the expert labels and consequently their respective violin plots look largely the same. For this reason, we only look at the violin plot made from rad_DF, and notice some changes in the plots across images. This makes sense because of the differing terrain and expert label values between the three images, and can be seen in the 'beautiful maps'. 
  We see similar differences between the violin plots for NDAI and CORR across images, but the plots for SD look exactly the same. The SD feature is used in the paper to identify smooth surfaces in the satellite images. Since we are using a small subset of images in our project, this leads me to believe that our images have largely smooth surfaces, since the violin plot with cloud label hugs the x-axis with an SD value close to zero. CORR is used as an average linear correlation average of radiation measurements at different view angles, and has a noticeable difference across the three images when compared to cloud labels. NDAI is defined as the normalized difference angular index, and has the widest and largest spread when compared to cloud labels, and is consistent across the three images. 
    The heatmap shows darker shaded boxes for cloud_label and NDAI as well as cloud_label and CORR. The box for cloud_label and SD however is less shaded. This is depicted in the respective violin plots - the higher the correlation, the greater the area inside the violin plot.